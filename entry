#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail

cleanup() {
    echo "cleaning up..."
    wg-quick down wg0
}

echo "using wireguard conf file: $WG_CONF_PATH"

wg-quick up wg0
if [[ ! -e /sys/class/net/wg0 ]]; then
    echo "wg0 not found, wireguard start failed."
    exit 1
fi

# 显示连接状况
sleep 1 && wg show
echo "" && echo "wg0 is installed"

trap cleanup TERM

while [[ -e /sys/class/net/wg0 ]]; do sleep 5; done

